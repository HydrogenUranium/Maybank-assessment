# Maven Build and Test

This GitHub Action executes a **Maven** build, runs tests, and uploads the resulting JaCoCo code coverage reports as a workflow artifact.

You can view the source `action.yaml` file [here](./action.yaml).

## Example Usage

```yaml
- name: Maven Build and Test
  uses: ./.github/actions/maven-build-and-test
```

## Action Details

This composite action provides a standard workflow for building and testing a Java project using Maven, with a focus on capturing and preserving test and code coverage results.

## Required `pom.xml` Configuration ⚙️

To enable the Jacoco scan, add the following plugin declarations within the `<plugins>` section of your `pom.xml`. The code snippets below use placeholders to highlight customizable values.

**JaCoCo Maven Plugin**
This plugin is essential for code coverage analysis. The `<exclude>` tag allows you to specify paths to files that should be excluded from the coverage report, which is useful for ignoring generated code or DTOs.

```xml
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>${jacoco.version}</version>
    <configuration>
        <excludes>
            <exclude>${jacoco.exclude.path}</exclude>
        </excludes>
    </configuration>
    <executions>
        <execution>
            <id>prepare-agent</id>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
            <configuration>
                <formats>
                    <format>XML</format>
                    <format>HTML</format>
                </formats>
            </configuration>
        </execution>
    </executions>
</plugin>
```
* `${jacoco.version}`: Replace with the desired JaCoCo plugin version (e.g., `0.8.13`).

* `${jacoco.exclude.path}`: Replace with the path to the folder you want to exclude from coverage analysis (e.g., `com/dhl/sample/dto/**`).

### Step-by-Step Process:

1.  **`Build and Test`**:
    * **Purpose**: This is the primary step for compiling the source code, running unit tests, and performing integration tests as configured in the `pom.xml`.
    * **Methodology**: It executes the **`mvn clean verify -B`** command.
        * `clean`: Removes the previous build output, ensuring a fresh build.
        * `verify`: Runs the entire build lifecycle up to the `verify` phase, which includes compiling code, running tests, and executing quality checks (like JaCoCo reports).
        * `-B`: Runs Maven in **batch mode**, which is non-interactive and prevents any prompts during the build.
    * **Outcome**: A successful run of this step generates the build artifacts and places test reports (Surefire) and code coverage data (JaCoCo) in the `target` directory.

2.  **`Upload JaCoCo code coverage results`**:
    * **Purpose**: This step ensures that the generated test and coverage reports are saved as a workflow artifact, making them accessible even after the job completes. This is crucial for debugging failures, analyzing code coverage trends, and integrating with other tools.
    * **Methodology**: It utilizes the **`actions/upload-artifact@v3`** action to upload a specific set of files and directories.
    * **`with` inputs**:
        * `name: jacoco-result`: Assigns the name `jacoco-result` to the artifact, making it easy to identify and download from the workflow run's summary page.
        * `path`: Specifies a list of paths to be included in the artifact. The action uploads:
            * `target/site/`: Contains the complete **JaCoCo HTML reports**, which can be downloaded and viewed locally to inspect coverage details.
            * `target/jacoco.exec`: The raw **JaCoCo execution data file**, which can be used by other tools for further analysis.
            * `target/surefire-reports`: The **JUnit test reports** generated by the Surefire plugin, useful for reviewing test outcomes.
    * **Outcome**: An artifact named `jacoco-result` is created, containing all specified files, which can be downloaded and inspected later.
